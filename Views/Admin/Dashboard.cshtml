@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "_AdminLayout";
}

<style>
    /* Glowing border and focus/active styles for ALL dropdown inputs and buttons in the backend */
    input[type="text"]:focus,
    button:focus,
    input[type="text"]:active,
    button:active {
        border-color: #818cf8 !important;
        box-shadow: 0 0 0 2px rgba(129, 140, 248, 0.3) !important;
        outline: none !important;
        z-index: 100;
        position: relative;
    }
    .input-group .btn {
        border-left: none !important;
    }
    [id*="DropdownMenu"] {
        z-index: 99999999 !important;
    }
    .dropdown-item {
        color: #818cf8 !important;
        background: transparent !important;
        transition: background 0.2s ease !important;
    }
    .dropdown-item:hover {
        background: rgba(129, 140, 248, 0.1) !important;
    }
</style>

<div class="admin-container">
    <div class="admin-sidebar">
        <div class="sidebar-header">
            <h2>Admin Panel</h2>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="#home" class="nav-link active" data-section="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li>
                    <a href="#videos" class="nav-link" data-section="videos">
                        <i class="fas fa-video"></i>
                        <span>Videos</span>
                    </a>
                </li>
                <li>
                    <a href="#skills" class="nav-link" data-section="skills">
                        <i class="fas fa-code"></i>
                        <span>Skills</span>
                    </a>
                </li>
                <li>
                    <a href="#projects" class="nav-link" data-section="projects">
                        <i class="fas fa-project-diagram"></i>
                        <span>Projects</span>
                    </a>
                </li>
                <li>
                    <a href="#about" class="nav-link" data-section="about">
                        <i class="fas fa-user"></i>
                        <span>About</span>
                    </a>
                </li>
                <li>
                    <a href="#navigation" class="nav-link" data-section="navigation">
                        <i class="fas fa-link"></i>
                        <span>Navigation</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <a href="@Url.Action("Logout", "Admin")" class="btn btn-danger btn-block">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>

    <div class="admin-content">
        <div class="content-header">
            <h1>Welcome to Admin Dashboard</h1>
            <p class="text-muted" style="color: #9ca3af !important;">Manage your portfolio content and settings</p>
            @if (ViewBag.IsReadOnly == true)
            {
                <p class="text-muted small mb-0"><span class="badge bg-secondary">Read only</span> You can view but not edit.</p>
            }
        </div>

        <div id="home" class="content-section active">
            <!-- Hero Section Card -->
            <div class="card mb-4 mt-3" style="margin-bottom: 1.5rem !important;">
                <div class="card-header">
                    <h5 class="mb-0" style="color: #818cf8 !important;">
                        <i class="fas fa-star"></i>
                        Hero
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted" style="color: #9ca3af !important;">Manage the hero content including title, subtitle, and action buttons.</p>
                    @if (ViewBag.IsReadOnly != true)
                    {
                    <div class="btn-group" role="group">
                        <button class="btn btn-primary" onclick="toggleHeroEdit()" id="editHeroBtn">
                            <i class="fas fa-edit"></i>
                            Edit Hero
                        </button>
                    </div>
                    }
                    
                    <!-- Hero Edit Form (Hidden by default) -->
                    <div id="heroEditForm" style="display: none !important; margin-top: 2rem;">
                        <form id="heroForm" asp-action="SaveHeroSection" asp-controller="Admin" method="post" enctype="multipart/form-data">
                            @Html.AntiForgeryToken()
                            
                            <!-- Template Section -->
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Template</h5>
                                <div class="card" style="overflow: visible;">
                                    <div class="card-body" style="overflow: visible;">
                                        <div class="mb-3" style="position: relative;">
                                            <label for="templateNickname" class="form-label" style="color: #9ca3af !important;">Nickname</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="templateNickname" placeholder="Enter new nickname or select existing..." style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                                <button class="btn btn-outline-secondary" type="button" id="templateDropdownBtn" style="border-color: rgba(129, 140, 248, 0.3) !important; color: #818cf8 !important; padding: 0.375rem 0.5rem !important; min-width: auto !important; display: flex !important; align-items: center !important; justify-content: center !important; background: transparent !important; width: 40px !important; height: 38px !important; line-height: 1 !important;">
                                                    <i class="fas fa-chevron-down" style="margin: 0 !important; padding: 0 !important; display: block !important;"></i>
                                                </button>
                                            </div>
                                            <!-- Dropdown menu inside the card -->
                                            <div id="customDropdownMenu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: rgba(0, 0, 10, 0.95); border: 1px solid rgba(129, 140, 248, 0.3); border-top: none; backdrop-filter: blur(10px); z-index: 99999999 !important; border-radius: 0 0 4px 4px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); opacity: 0; transform: translateY(-10px) scale(0.95); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); margin-top: -1px;">
                                                <div class="dropdown-item" onclick="clearTemplateSelection()" style="color: #818cf8; background: transparent; padding: 0.5rem 1rem; cursor: pointer; transition: background 0.2s ease;" onmouseenter="this.style.background='rgba(129, 140, 248, 0.1)';" onmouseleave="this.style.background='transparent';">Clear Selection</div>
                                                <div id="templateOptions">
                                                    <!-- Template options will be loaded here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Main Content -->
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Main Content</h5>
                                <div class="card" style="overflow: visible;">
                                    <div class="card-body">
                                        
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="heroTitle" class="form-label" style="color: #9ca3af !important;">Title</label>
                                                <input type="text" class="form-control" id="heroTitle" name="HeaderTitle" maxlength="100" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="heroSubtitle" class="form-label" style="color: #9ca3af !important;">Subtitle</label>
                                                <input type="text" class="form-control" id="heroSubtitle" name="HeaderSubtitle" maxlength="500" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="heroDescription" class="form-label" style="color: #9ca3af !important;">Description</label>
                                            <textarea class="form-control" id="heroDescription" name="HeaderDescription" maxlength="1000" rows="3" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Background -->
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Background</h5>
                                <div class="card" style="overflow: visible;">
                                    <div class="card-body">
                                        <!-- Background Type Toggle -->
                                        <div class="mb-3">
                                            <label class="form-label" style="color: #9ca3af !important;">Background Type</label>
                                            <div class="toggle-container">
                                                <span id="imageLabel" class="toggle-label" style="color: #818cf8 !important; font-weight: 500;">Image</span>
                                                <div class="form-check form-switch toggle-wrapper">
                                                    <input class="form-check-input" type="checkbox" id="backgroundTypeToggle" onchange="toggleBackgroundType()">
                                                    <div class="particle-container" id="toggleParticles"></div>
                                                </div>
                                                <span id="videoLabel" class="toggle-label" style="color: #6b7280 !important;">Video</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Image: upload only (stored on server); no URL field -->
                                        <input type="hidden" name="HeaderBackgroundImageUrl" id="heroBackgroundImageUrlHidden" value="">
                                        <div class="mb-3" id="heroImageUploadField">
                                            <label for="heroBackgroundImageFile" class="form-label" style="color: #9ca3af !important;">Background Image</label>
                                            <input type="file" class="form-control" id="heroBackgroundImageFile" name="HeroBackgroundImage" accept="image/jpeg,image/png,image/gif,image/webp" style="color: #818cf8 !important;">
                                            <small id="heroImageUploadHint" class="text-muted" style="color: #6b7280 !important; display: block; margin-top: 0.35rem;">Upload stores the image on this server. Upload a new file to replace the current image.</small>
                                            
                                            <!-- Image Overlay Settings -->
                                            <div class="mt-4 overlay-controls" id="imageOverlayControls">
                                                <div class="overlay-header">
                                                    <div class="overlay-toggle" onclick="toggleImageOverlay()">
                                                        <div class="toggle-circle" id="imageToggleCircle"></div>
                                                        <span class="overlay-label">Image Overlay</span>
                                                    </div>
                                                </div>
                                                <div class="overlay-settings" id="imageOverlaySettings">
                                                    <div class="setting-group">
                                                        <label class="setting-label">Overlay Color</label>
                                                        <div class="color-picker-container">
                                                            <input type="color" id="imageOverlayColor" name="ImageOverlayColor" value="#000000" class="color-picker">
                                                            <div class="color-preview" id="imageColorPreview"></div>
                                                        </div>
                                                    </div>
                                                    <div class="setting-group">
                                                        <label class="setting-label">Opacity</label>
                                                        <div class="custom-slider-container">
                                                            <div class="custom-slider-track">
                                                                <div class="custom-slider-fill" id="imageSliderFill"></div>
                                                                <div class="custom-slider-thumb" id="imageSliderThumb"></div>
                                                            </div>
                                                            <input type="hidden" id="imageOverlayOpacity" name="ImageOverlayOpacity" value="50">
                                                            <div class="slider-value" id="imageSliderValue">50%</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Video URL Field -->
                                        <div class="mb-3" id="videoUrlField" style="display: none;">
                                            <label for="heroBackgroundVideo" class="form-label" style="color: #9ca3af !important;">Background Video URL</label>
                                            <input type="text" class="form-control" id="heroBackgroundVideo" name="HeaderBackgroundVideoUrl" maxlength="500" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            
                                            <!-- Video Overlay Settings -->
                                            <div class="mt-4 overlay-controls" id="videoOverlayControls">
                                                <div class="overlay-header">
                                                    <div class="overlay-toggle" onclick="toggleVideoOverlay()">
                                                        <div class="toggle-circle" id="videoToggleCircle"></div>
                                                        <span class="overlay-label">Video Overlay</span>
                                                    </div>
                                                </div>
                                                <div class="overlay-settings" id="videoOverlaySettings">
                                                    <div class="setting-group">
                                                        <label class="setting-label">Overlay Color</label>
                                                        <div class="color-picker-container">
                                                            <input type="color" id="videoOverlayColor" name="VideoOverlayColor" value="#000000" class="color-picker">
                                                            <div class="color-preview" id="videoColorPreview"></div>
                                                        </div>
                                                    </div>
                                                    <div class="setting-group">
                                                        <label class="setting-label">Opacity</label>
                                                        <div class="custom-slider-container">
                                                            <div class="custom-slider-track">
                                                                <div class="custom-slider-fill" id="videoSliderFill"></div>
                                                                <div class="custom-slider-thumb" id="videoSliderThumb"></div>
                                                            </div>
                                                            <input type="hidden" id="videoOverlayOpacity" name="VideoOverlayOpacity" value="50">
                                                            <div class="slider-value" id="videoSliderValue">50%</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Primary Button -->
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Primary Button</h5>
                                <div class="card" style="overflow: visible;">
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="heroPrimaryButtonText" class="form-label" style="color: #9ca3af !important;">Button Text</label>
                                            <input type="text" class="form-control" id="heroPrimaryButtonText" name="HeaderPrimaryButtonText" maxlength="50" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                        </div>
                                        <div class="mb-3">
                                            <label for="heroPrimaryButtonUrl" class="form-label" style="color: #9ca3af !important;">Button URL</label>
                                            <input type="text" class="form-control" id="heroPrimaryButtonUrl" name="HeaderPrimaryButtonUrl" maxlength="200" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex gap-2 justify-content-between">
                                <button type="button" class="btn btn-danger btn-block" onclick="deleteTemplate()">
                                    <i class="fas fa-trash"></i>
                                    Delete Template
                                </button>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-secondary" onclick="toggleHeroEdit()">
                                        <i class="fas fa-times"></i>
                                        Cancel
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Features List Section Card -->
            <div class="card mb-4" style="margin-bottom: 1.5rem !important;">
                <div class="card-header">
                    <h5 class="mb-0" style="color: #818cf8 !important;">
                        <i class="fas fa-list"></i>
                        Features List Section
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted" style="color: #9ca3af !important;">Manage the Key Skills & Technologies section with its three feature cards.</p>
                    @if (ViewBag.IsReadOnly != true)
                    {
                    <div class="btn-group" role="group">
                        <button class="btn btn-primary" onclick="toggleFeaturesEdit()" id="editFeaturesBtn">
                            <i class="fas fa-edit"></i>
                            Edit Features
                        </button>
                    </div>
                    }
                    <div id="featuresEditForm" style="display: none !important; margin-top: 2rem;">
                        <form id="featuresForm" asp-action="SaveFeaturesSection" asp-controller="Admin" method="post">
                            @Html.AntiForgeryToken()
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Template</h5>
                                <div class="card" style="overflow: visible;">
                                    <div class="card-body" style="overflow: visible;">
                                        <div class="mb-3" style="position: relative;">
                                            <label for="featuresTemplateNickname" class="form-label" style="color: #9ca3af !important;">Nickname</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="featuresTemplateNickname" placeholder="Enter new nickname or select existing..." style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                                <button class="btn btn-outline-secondary" type="button" id="featuresTemplateDropdownBtn" style="border-color: rgba(129, 140, 248, 0.3) !important; color: #818cf8 !important; padding: 0.375rem 0.5rem !important; min-width: auto !important; width: 40px !important; height: 38px !important;">
                                                    <i class="fas fa-chevron-down"></i>
                                                </button>
                                            </div>
                                            <div id="featuresCustomDropdownMenu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: rgba(0, 0, 10, 0.95); border: 1px solid rgba(129, 140, 248, 0.3); border-top: none; z-index: 99999999 !important; border-radius: 0 0 4px 4px; margin-top: -1px;">
                                                <div class="dropdown-item" onclick="clearFeaturesTemplateSelection()" style="color: #818cf8; padding: 0.5rem 1rem; cursor: pointer;">Clear Selection</div>
                                                <div id="featuresTemplateOptions"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Section Header</h5>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="featuresTitle" class="form-label" style="color: #9ca3af !important;">Section Title</label>
                                                <input type="text" class="form-control" id="featuresTitle" name="SectionTitle" maxlength="100" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="featuresSubtitle" class="form-label" style="color: #9ca3af !important;">Section Subtitle</label>
                                                <input type="text" class="form-control" id="featuresSubtitle" name="SectionSubtitle" maxlength="200" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Feature 1</h5>
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="feature1Title" class="form-label" style="color: #9ca3af !important;">Title</label>
                                                <input type="text" class="form-control" id="feature1Title" name="Feature1Title" maxlength="100" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="feature1Subtitle" class="form-label" style="color: #9ca3af !important;">Subtitle</label>
                                                <input type="text" class="form-control" id="feature1Subtitle" name="Feature1Subtitle" maxlength="200" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                                <label for="feature1Link" class="form-label" style="color: #9ca3af !important;">Link</label>
                                                <input type="text" class="form-control" id="feature1Link" name="Feature1Link" maxlength="200" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="mb-3">
                                                <label for="feature1LinkText" class="form-label" style="color: #9ca3af !important;">Link text</label>
                                                <input type="text" class="form-control" id="feature1LinkText" name="Feature1LinkText" maxlength="100" placeholder="e.g. Learn more" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        <div class="mb-3">
                                            <label for="feature1Description" class="form-label" style="color: #9ca3af !important;">Description</label>
                                            <textarea class="form-control" id="feature1Description" name="Feature1Description" maxlength="500" rows="2" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <h5 class="mb-3" style="color: #818cf8 !important;">Feature 2</h5>
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="feature2Title" class="form-label" style="color: #9ca3af !important;">Title</label>
                                                <input type="text" class="form-control" id="feature2Title" name="Feature2Title" maxlength="100" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="feature2Subtitle" class="form-label" style="color: #9ca3af !important;">Subtitle</label>
                                                <input type="text" class="form-control" id="feature2Subtitle" name="Feature2Subtitle" maxlength="200" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                                <label for="feature2Link" class="form-label" style="color: #9ca3af !important;">Link</label>
                                                <input type="text" class="form-control" id="feature2Link" name="Feature2Link" maxlength="200" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="mb-3">
                                                <label for="feature2LinkText" class="form-label" style="color: #9ca3af !important;">Link text</label>
                                                <input type="text" class="form-control" id="feature2LinkText" name="Feature2LinkText" maxlength="100" placeholder="e.g. Learn more" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        <div class="mb-3">
                                            <label for="feature2Description" class="form-label" style="color: #9ca3af !important;">Description</label>
                                            <textarea class="form-control" id="feature2Description" name="Feature2Description" maxlength="500" rows="2" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <h5 class="mb-3" style="color: #818cf8 !important;">Feature 3</h5>
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="feature3Title" class="form-label" style="color: #9ca3af !important;">Title</label>
                                                <input type="text" class="form-control" id="feature3Title" name="Feature3Title" maxlength="100" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="feature3Subtitle" class="form-label" style="color: #9ca3af !important;">Subtitle</label>
                                                <input type="text" class="form-control" id="feature3Subtitle" name="Feature3Subtitle" maxlength="200" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                                <label for="feature3Link" class="form-label" style="color: #9ca3af !important;">Link</label>
                                                <input type="text" class="form-control" id="feature3Link" name="Feature3Link" maxlength="200" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="mb-3">
                                                <label for="feature3LinkText" class="form-label" style="color: #9ca3af !important;">Link text</label>
                                                <input type="text" class="form-control" id="feature3LinkText" name="Feature3LinkText" maxlength="100" placeholder="e.g. Learn more" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        <div class="mb-3">
                                            <label for="feature3Description" class="form-label" style="color: #9ca3af !important;">Description</label>
                                            <textarea class="form-control" id="feature3Description" name="Feature3Description" maxlength="500" rows="2" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex gap-2 justify-content-between">
                                <button type="button" class="btn btn-danger" onclick="deleteFeaturesTemplate()" id="deleteFeaturesBtn"><i class="fas fa-trash"></i> Delete Template</button>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-secondary" onclick="toggleFeaturesEdit()"><i class="fas fa-times"></i> Cancel</button>
                                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- CTA Section Card -->
            <div class="card mb-4" style="margin-bottom: 1.5rem !important;">
                <div class="card-header">
                    <h5 class="mb-0" style="color: #818cf8 !important;">
                        <i class="fas fa-bullhorn"></i>
                        Call to Action Section
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted" style="color: #9ca3af !important;">Manage the CTA section content including title, subtitle, and action button.</p>
                    @if (ViewBag.IsReadOnly != true)
                    {
                    <div class="btn-group" role="group">
                        <button class="btn btn-primary" onclick="toggleCTAEdit()" id="editCTABtn">
                            <i class="fas fa-edit"></i>
                            Edit CTA
                        </button>
                    </div>
                    }
                    <div id="ctaEditForm" style="display: none !important; margin-top: 2rem;">
                        <form id="ctaForm" asp-action="SaveCTASection" asp-controller="Admin" method="post">
                            @Html.AntiForgeryToken()
                            <div class="mb-4">
                                <h5 class="mb-3" style="color: #818cf8 !important;">Template</h5>
                                <div class="card" style="overflow: visible;">
                                    <div class="card-body" style="overflow: visible;">
                                        <div class="mb-3" style="position: relative;">
                                            <label for="ctaTemplateNickname" class="form-label" style="color: #9ca3af !important;">Nickname</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="ctaTemplateNickname" placeholder="Enter new nickname or select existing..." style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                                <button class="btn btn-outline-secondary" type="button" id="ctaTemplateDropdownBtn" style="border-color: rgba(129, 140, 248, 0.3) !important; color: #818cf8 !important; padding: 0.375rem 0.5rem !important; min-width: auto !important; width: 40px !important; height: 38px !important;">
                                                    <i class="fas fa-chevron-down"></i>
                                                </button>
                                            </div>
                                            <div id="ctaCustomDropdownMenu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: rgba(0, 0, 10, 0.95); border: 1px solid rgba(129, 140, 248, 0.3); border-top: none; z-index: 99999999 !important; border-radius: 0 0 4px 4px; margin-top: -1px;">
                                                <div class="dropdown-item" onclick="clearCTATemplateSelection()" style="color: #818cf8; padding: 0.5rem 1rem; cursor: pointer;">Clear Selection</div>
                                                <div id="ctaTemplateOptions"></div>
                                            </div>
                                        </div>
                                        <h5 class="mb-3" style="color: #818cf8 !important;">CTA Content</h5>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="ctaTitle" class="form-label" style="color: #9ca3af !important;">Title</label>
                                                <input type="text" class="form-control" id="ctaTitle" name="Title" maxlength="200" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="ctaSubtitle" class="form-label" style="color: #9ca3af !important;">Subtitle</label>
                                                <input type="text" class="form-control" id="ctaSubtitle" name="Subtitle" maxlength="500" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="ctaButtonText" class="form-label" style="color: #9ca3af !important;">Button Text</label>
                                                <input type="text" class="form-control" id="ctaButtonText" name="ButtonText" maxlength="100" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="ctaButtonLink" class="form-label" style="color: #9ca3af !important;">Button Link</label>
                                                <input type="text" class="form-control" id="ctaButtonLink" name="ButtonLink" maxlength="500" required style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;">
                                            </div>
                                        </div>
                                        <div class="d-flex gap-2 justify-content-between mt-3">
                                            <button type="button" class="btn btn-danger" onclick="deleteCTATemplate()" id="deleteCTABtn"><i class="fas fa-trash"></i> Delete Template</button>
                                            <div class="d-flex gap-2">
                                                <button type="button" class="btn btn-secondary" onclick="toggleCTAEdit()"><i class="fas fa-times"></i> Cancel</button>
                                                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Footer Section Card -->
            <div class="card mb-4" style="margin-bottom: 1.5rem !important;">
                <div class="card-header">
                    <h5 class="mb-0" style="color: #818cf8 !important;">
                        <i class="fas fa-shoe-prints"></i>
                        Footer Section
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted" style="color: #9ca3af !important;">Manage the footer content and links.</p>
                    <button class="btn btn-primary" onclick="editSection('footer')">
                        <i class="fas fa-edit"></i>
                        Edit Footer
                    </button>
                </div>
            </div>
        </div>

        <div id="navigation" class="content-section">
            <div class="card mb-4 mt-3" style="margin-bottom: 1.5rem !important;">
                <div class="card-header">
                    <h5 class="mb-0" style="color: #818cf8 !important;">
                        <i class="fas fa-link"></i>
                        Navigation links
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted" style="color: #9ca3af !important;">Show or hide the Graphic Design and Design links in the main nav until those pages have more content.</p>
                    @if (ViewBag.IsReadOnly != true)
                    {
                    <form id="navSettingsForm" asp-action="SaveNavSettings" asp-controller="Admin" method="post">
                        @Html.AntiForgeryToken()
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="showGraphicDesignLink" name="showGraphicDesignLink" value="true" @(ViewBag.NavSettings?.ShowGraphicDesignLink == true ? "checked" : "")>
                                <label class="form-check-label" for="showGraphicDesignLink" style="color: #9ca3af !important;">Show &quot;Graphic Design&quot; in nav</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="showDesignLink" name="showDesignLink" value="true" @(ViewBag.NavSettings?.ShowDesignLink == true ? "checked" : "")>
                                <label class="form-check-label" for="showDesignLink" style="color: #9ca3af !important;">Show &quot;Design&quot; in nav</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                    }
                    else
                    {
                    <p class="mb-0 small">Graphic Design: @(ViewBag.NavSettings?.ShowGraphicDesignLink == true ? "Shown" : "Hidden") Â· Design: @(ViewBag.NavSettings?.ShowDesignLink == true ? "Shown" : "Hidden")</p>
                    }
                </div>
            </div>
        </div>

        <div id="skills" class="content-section">
            <div class="card mb-4 mt-3" style="margin-bottom: 1.5rem !important;">
                <div class="card-header">
                    <h5 class="mb-0" style="color: #818cf8 !important;">
                        <i class="fas fa-code"></i>
                        Skills categories
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted" style="color: #9ca3af !important;">Manage skill categories (e.g. Frontend, Backend, Tools). Each category has a title and a list of skills (one per line or comma-separated).</p>
                    @if (ViewBag.IsReadOnly != true)
                    {
                    <div class="mb-3">
                        <button type="button" class="btn btn-outline-primary me-2" id="btnLoadDefaultSkills">
                            <i class="fas fa-download"></i> Load default skills
                        </button>
                        <span class="text-muted small">Loads Frontend, Backend, Databases, Tools, Practices with your provided skill lists.</span>
                    </div>
                    <hr style="border-color: rgba(129, 140, 248, 0.2);" />
                    <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
                        <h6 class="mb-0" style="color: #818cf8 !important;">Existing categories</h6>
                        <button type="button" class="btn btn-primary btn-sm" id="btnAddSkillsCategory">
                            <i class="fas fa-plus"></i> Add category
                        </button>
                    </div>
                    <p class="text-muted small mb-2" style="color: #9ca3af !important;">Click <strong>Add category</strong> to create a new one, or <strong>Edit</strong> on a card to update it. Use <strong>Cancel</strong> to close the form.</p>
                    <div class="row g-3 mb-4" id="skillsCategoryList">
                        @if (ViewBag.SkillsCategories != null && ((IEnumerable<object>)ViewBag.SkillsCategories).Any())
                        {
                            @foreach (var c in ViewBag.SkillsCategories)
                            {
                                var d = (dynamic)c;
                                var skillCount = d.Skills?.Count ?? 0;
                                var skillsList = d.Skills != null ? (IEnumerable<string>)d.Skills : new List<string>();
                                var skillsJson = System.Text.Json.JsonSerializer.Serialize(skillsList);
                                var skillsPipe = string.Join("|", skillsList);
                                <div class="col-12 col-sm-6 col-lg-4">
                                    <div class="card skills-category-row h-100" style="background: rgba(10,10,20,0.6); border: 1px solid rgba(129, 140, 248, 0.2);" data-id="@d.Id" data-title="@d.Title" data-description="@(d.Description ?? "")" data-displayorder="@d.DisplayOrder" data-active="@d.IsActive" data-skills-json="@System.Net.WebUtility.HtmlEncode(skillsJson)" data-skills="@System.Net.WebUtility.HtmlEncode(skillsPipe)">
                                        <div class="card-body d-flex flex-column">
                                            <h6 class="card-title mb-2" style="color: #818cf8 !important;">@d.Title</h6>
                                            <p class="card-text text-muted small mb-2" style="color: #9ca3af !important;"><span class="badge bg-secondary">@skillCount skills</span></p>
                                            <div class="mt-auto pt-2 d-flex gap-2">
                                                <button type="button" class="btn btn-sm btn-primary editSkillsCatBtn"><i class="fas fa-edit"></i> Edit</button>
                                                <button type="button" class="btn btn-sm btn-outline-danger deleteSkillsCatBtn"><i class="fas fa-trash"></i> Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="col-12">
                                <div class="card" style="background: rgba(10,10,20,0.6); border: 1px solid rgba(129, 140, 248, 0.2);">
                                    <div class="card-body text-muted" style="color: #9ca3af !important;">No categories yet. Click <strong>Add category</strong> above or use <strong>Load default skills</strong>.</div>
                                </div>
                            </div>
                        }
                    </div>
                    <div id="skillsCategoryFormCard" class="mb-0" style="display: none;">
                        <h6 class="mb-2" id="skillsFormHeading" style="color: #818cf8 !important;">Add new category</h6>
                        <div class="card">
                            <div class="card-body">
                        <form id="skillsCategoryForm" method="post" asp-action="SaveSkillsCategory" asp-controller="Admin">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" id="skillsCategoryId" value="0" />
                        <div class="mb-3">
                            <label for="skillsCategoryTitle" class="form-label" style="color: #9ca3af !important;">Title</label>
                            <input type="text" class="form-control" id="skillsCategoryTitle" name="title" required maxlength="100" placeholder="e.g. Frontend" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;" />
                        </div>
                        <div class="mb-3">
                            <label for="skillsCategoryDescription" class="form-label" style="color: #9ca3af !important;">Description (optional)</label>
                            <input type="text" class="form-control" id="skillsCategoryDescription" name="description" maxlength="500" placeholder="e.g. Frontend technologies" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;" />
                        </div>
                        <div class="mb-3">
                            <label for="skillsCategorySkillsText" class="form-label" style="color: #9ca3af !important;">Skills (one per line or comma-separated)</label>
                            <textarea class="form-control" id="skillsCategorySkillsText" name="skillsText" rows="6" placeholder="React.js&#10;JavaScript&#10;TypeScript" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;"></textarea>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="skillsCategoryDisplayOrder" class="form-label" style="color: #9ca3af !important;">Display order</label>
                                <input type="number" class="form-control" id="skillsCategoryDisplayOrder" name="displayOrder" value="1" min="0" style="color: #818cf8 !important; -webkit-text-fill-color: #818cf8 !important;" />
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="skillsCategoryIsActive" name="isActive" value="true" checked />
                                    <label class="form-check-label" for="skillsCategoryIsActive" style="color: #9ca3af !important;">Active</label>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save category</button>
                        <button type="button" class="btn btn-secondary ms-2" id="skillsCategoryCancelBtn"><i class="fas fa-times"></i> Cancel</button>
                    </form>
                            </div>
                        </div>
                    </div>
                    }
                    else
                    {
                    <ul class="list-group" style="background: transparent; border-color: rgba(129, 140, 248, 0.2);">
                        @foreach (var c in ViewBag.SkillsCategories)
                        {
                            var d = (dynamic)c;
                            <li class="list-group-item" style="background: rgba(10,10,20,0.6); color: #9ca3af; border-color: rgba(129, 140, 248, 0.2);"><strong style="color: #818cf8;">@d.Title</strong> â @(d.Skills?.Count ?? 0) skills</li>
                        }
                    </ul>
                    }
                </div>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    <script>
        // Navigation handling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const navLink = e.target.closest('.nav-link');
                
                if (!navLink) return; // Guard against null
                
                const section = navLink.dataset.section;
                
                // Update active states
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                navLink.classList.add('active');
                
                const targetSection = document.getElementById(section);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });

        // On load, activate section from URL hash or sessionStorage (e.g. after Save skills)
        (function() {
            let section = (window.location.hash || '').replace(/^#/, '');
            const stored = sessionStorage.getItem('adminReturnSection');
            if (stored) {
                section = stored;
                sessionStorage.removeItem('adminReturnSection');
            }
            if (section && document.getElementById(section)) {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                const navLink = document.querySelector('.nav-link[data-section="' + section + '"]');
                const sectionEl = document.getElementById(section);
                if (navLink) navLink.classList.add('active');
                if (sectionEl) sectionEl.classList.add('active');
            }
        })();

        // Toggle hero edit form
        function toggleHeroEdit() {
            const form = document.getElementById('heroEditForm');
            const editButton = document.querySelector('.btn-primary[onclick="toggleHeroEdit()"]');
            
            console.log('toggleHeroEdit called');
            console.log('Form display before:', form.style.display);
            console.log('Form computed display:', window.getComputedStyle(form).display);
            console.log('Form element:', form);
            console.log('Edit button:', editButton);
            
            if (form.style.display === 'none' || form.style.display === '') {
                // Show form, hide edit button
                editButton.style.opacity = '0';
                editButton.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    editButton.style.display = 'none';
                    form.style.display = 'block';
                    form.style.opacity = '0';
                    form.style.transform = 'translateY(10px)';
                    
                    setTimeout(() => {
                        form.style.opacity = '1';
                        form.style.transform = 'translateY(0)';
                    }, 50);
                }, 200);
            } else {
                // Hide form, show edit button
                form.style.opacity = '0';
                form.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    form.style.display = 'none';
                    editButton.style.display = 'inline-flex';
                    editButton.style.opacity = '0';
                    editButton.style.transform = 'translateY(10px)';
                    
                    setTimeout(() => {
                        editButton.style.opacity = '1';
                        editButton.style.transform = 'translateY(0)';
                    }, 50);
                }, 200);
            }
        }

        // Hero form submission is handled in initializeFormSubmission() (FormData to /Admin/SaveHeroSection).

        // Content management functions
        function addHomeContent() {
            // TODO: Implement add home content
        }

        function addVideo() {
            // TODO: Implement add video
        }

        function addSkill() {
            // TODO: Implement add skill
        }

        function addProject() {
            // TODO: Implement add project
        }

        function editAbout() {
            // TODO: Implement edit about
        }

        function editSection(sectionId) {
            if (sectionId === 'footer') {
                console.log('Footer editing not implemented yet');
                return;
            }
            console.log(`Editing section: ${sectionId}`);
        }

        function editFeature(featureId) {
            console.log(`Editing feature: ${featureId}`);
        }

        // ----- Features Section -----
        function toggleFeaturesEdit() {
            const form = document.getElementById('featuresEditForm');
            const btn = document.getElementById('editFeaturesBtn');
            if (!form || !btn) return;
            const show = form.style.display === 'none' || !form.style.display;
            form.style.display = show ? 'block' : 'none';
            btn.style.display = show ? 'none' : 'inline-block';
            if (show) {
                loadFeaturesData();
                loadFeaturesTemplates();
                setupFeaturesDropdown();
            }
        }
        async function loadFeaturesData() {
            try {
                const response = await fetch('/Admin/GetFeaturesSection');
                const result = await response.json();
                if (result.success && result.data) {
                    const d = result.data;
                    const set = (id, v) => { const el = document.getElementById(id); if (el) el.value = v || ''; };
                    set('featuresTitle', d.sectionTitle); set('featuresSubtitle', d.sectionSubtitle);
                    set('feature1Title', d.feature1Title); set('feature1Subtitle', d.feature1Subtitle); set('feature1Link', d.feature1Link); set('feature1LinkText', d.feature1LinkText); set('feature1Description', d.feature1Description);
                    set('feature2Title', d.feature2Title); set('feature2Subtitle', d.feature2Subtitle); set('feature2Link', d.feature2Link); set('feature2LinkText', d.feature2LinkText); set('feature2Description', d.feature2Description);
                    set('feature3Title', d.feature3Title); set('feature3Subtitle', d.feature3Subtitle); set('feature3Link', d.feature3Link); set('feature3LinkText', d.feature3LinkText); set('feature3Description', d.feature3Description);
                }
            } catch (e) { console.error('Load features error', e); }
        }
        let featuresTemplatesList = [];
        async function loadFeaturesTemplates() {
            try {
                const response = await fetch('/Admin/GetFeaturesTemplates');
                const result = await response.json();
                featuresTemplatesList = result.data || [];
                const container = document.getElementById('featuresTemplateOptions');
                if (!container) return;
                container.innerHTML = '';
                featuresTemplatesList.forEach(t => {
                    const div = document.createElement('div');
                    div.className = 'dropdown-item';
                    div.style.cssText = 'color: #818cf8; padding: 0.5rem 1rem; cursor: pointer;';
                    div.textContent = t.nickname || ('Template ' + t.id);
                    div.onclick = () => { selectFeaturesTemplate(t.id, t.nickname); document.getElementById('featuresCustomDropdownMenu').style.display = 'none'; };
                    container.appendChild(div);
                });
            } catch (e) { console.error('Load features templates error', e); }
        }
        function setupFeaturesDropdown() {
            const btn = document.getElementById('featuresTemplateDropdownBtn');
            const menu = document.getElementById('featuresCustomDropdownMenu');
            if (!btn || !menu) return;
            btn.onclick = () => { menu.style.display = menu.style.display === 'none' ? 'block' : 'none'; };
            document.addEventListener('click', function closeFeatures(e) {
                if (!btn.contains(e.target) && !menu.contains(e.target)) { menu.style.display = 'none'; document.removeEventListener('click', closeFeatures); }
            });
        }
        function clearFeaturesTemplateSelection() {
            document.getElementById('featuresTemplateNickname').value = '';
            document.getElementById('featuresCustomDropdownMenu').style.display = 'none';
        }
        async function selectFeaturesTemplate(id, nickname) {
            document.getElementById('featuresTemplateNickname').value = nickname || '';
            try {
                const response = await fetch('/Admin/GetFeaturesTemplate?id=' + id);
                const result = await response.json();
                if (result.success && result.data) {
                    const d = result.data;
                    const set = (id, v) => { const el = document.getElementById(id); if (el) el.value = v || ''; };
                    set('featuresTitle', d.sectionTitle); set('featuresSubtitle', d.sectionSubtitle);
                    set('feature1Title', d.feature1Title); set('feature1Subtitle', d.feature1Subtitle); set('feature1Link', d.feature1Link); set('feature1LinkText', d.feature1LinkText); set('feature1Description', d.feature1Description);
                    set('feature2Title', d.feature2Title); set('feature2Subtitle', d.feature2Subtitle); set('feature2Link', d.feature2Link); set('feature2LinkText', d.feature2LinkText); set('feature2Description', d.feature2Description);
                    set('feature3Title', d.feature3Title); set('feature3Subtitle', d.feature3Subtitle); set('feature3Link', d.feature3Link); set('feature3LinkText', d.feature3LinkText); set('feature3Description', d.feature3Description);
                }
            } catch (e) { console.error('Load features template error', e); }
        }
        async function deleteFeaturesTemplate() {
            const nickname = document.getElementById('featuresTemplateNickname').value.trim();
            if (!nickname) { alert('Select or enter a template nickname to delete.'); return; }
            const t = featuresTemplatesList.find(x => (x.nickname || '').toLowerCase() === nickname.toLowerCase());
            if (!t) { alert('Template not found.'); return; }
            if (!confirm('Delete template "' + nickname + '"?')) return;
            const token = document.querySelector('#featuresForm input[name="__RequestVerificationToken"]').value;
            const fd = new FormData(); fd.append('__RequestVerificationToken', token); fd.append('id', t.id);
            const response = await fetch('/Admin/DeleteFeaturesTemplate', { method: 'POST', body: fd });
            const result = await response.json();
            alert(result.message || (result.success ? 'Deleted.' : 'Error'));
            if (result.success) { clearFeaturesTemplateSelection(); loadFeaturesTemplates(); }
        }
        document.addEventListener('DOMContentLoaded', function() {
            const featuresForm = document.getElementById('featuresForm');
            if (featuresForm) featuresForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const nickname = document.getElementById('featuresTemplateNickname').value.trim();
                if (nickname) {
                    const t = featuresTemplatesList.find(x => (x.nickname || '').toLowerCase() === nickname.toLowerCase());
                    if (t) formData.append('Id', t.id);
                    formData.append('Nickname', nickname);
                    formData.append('SectionTitle', formData.get('SectionTitle'));
                    formData.append('Feature1Title', formData.get('Feature1Title')); formData.append('Feature1Subtitle', formData.get('Feature1Subtitle')); formData.append('Feature1Description', formData.get('Feature1Description')); formData.append('Feature1Link', formData.get('Feature1Link')); formData.append('Feature1LinkText', formData.get('Feature1LinkText'));
                    formData.append('Feature2Title', formData.get('Feature2Title')); formData.append('Feature2Subtitle', formData.get('Feature2Subtitle')); formData.append('Feature2Description', formData.get('Feature2Description')); formData.append('Feature2Link', formData.get('Feature2Link')); formData.append('Feature2LinkText', formData.get('Feature2LinkText'));
                    formData.append('Feature3Title', formData.get('Feature3Title')); formData.append('Feature3Subtitle', formData.get('Feature3Subtitle')); formData.append('Feature3Description', formData.get('Feature3Description')); formData.append('Feature3Link', formData.get('Feature3Link')); formData.append('Feature3LinkText', formData.get('Feature3LinkText'));
                    const saveResp = await fetch(t ? '/Admin/SaveFeaturesTemplate' : '/Admin/SaveFeaturesTemplate', { method: 'POST', body: formData });
                    const saveRes = await saveResp.json();
                    if (!saveRes.success) { alert(saveRes.message); return; }
                }
                const sectionFormData = new FormData(this);
                const sectionResp = await fetch('/Admin/SaveFeaturesSection', { method: 'POST', body: sectionFormData });
                const sectionRes = await sectionResp.json();
                alert(sectionRes.message || (sectionRes.success ? 'Saved.' : 'Error'));
                if (sectionRes.success) toggleFeaturesEdit();
            });
        });

        // ----- CTA Section -----
        function toggleCTAEdit() {
            const form = document.getElementById('ctaEditForm');
            const btn = document.getElementById('editCTABtn');
            if (!form || !btn) return;
            const show = form.style.display === 'none' || !form.style.display;
            form.style.display = show ? 'block' : 'none';
            btn.style.display = show ? 'none' : 'inline-block';
            if (show) {
                loadCTAData();
                loadCTATemplates();
                setupCTADropdown();
            }
        }
        async function loadCTAData() {
            try {
                const response = await fetch('/Admin/GetCTASection');
                const result = await response.json();
                if (result.success && result.data) {
                    const d = result.data;
                    const set = (id, v) => { const el = document.getElementById(id); if (el) el.value = v || ''; };
                    set('ctaTitle', d.title); set('ctaSubtitle', d.subtitle); set('ctaButtonText', d.buttonText); set('ctaButtonLink', d.buttonLink);
                }
            } catch (e) { console.error('Load CTA error', e); }
        }
        let ctaTemplatesList = [];
        async function loadCTATemplates() {
            try {
                const response = await fetch('/Admin/GetCTATemplates');
                const result = await response.json();
                ctaTemplatesList = result.data || [];
                const container = document.getElementById('ctaTemplateOptions');
                if (!container) return;
                container.innerHTML = '';
                ctaTemplatesList.forEach(t => {
                    const div = document.createElement('div');
                    div.className = 'dropdown-item';
                    div.style.cssText = 'color: #818cf8; padding: 0.5rem 1rem; cursor: pointer;';
                    div.textContent = t.nickname || ('Template ' + t.id);
                    div.onclick = () => { selectCTATemplate(t.id, t.nickname); document.getElementById('ctaCustomDropdownMenu').style.display = 'none'; };
                    container.appendChild(div);
                });
            } catch (e) { console.error('Load CTA templates error', e); }
        }
        function setupCTADropdown() {
            const btn = document.getElementById('ctaTemplateDropdownBtn');
            const menu = document.getElementById('ctaCustomDropdownMenu');
            if (!btn || !menu) return;
            btn.onclick = () => { menu.style.display = menu.style.display === 'none' ? 'block' : 'none'; };
            document.addEventListener('click', function closeCTA(e) {
                if (!btn.contains(e.target) && !menu.contains(e.target)) { menu.style.display = 'none'; document.removeEventListener('click', closeCTA); }
            });
        }
        function clearCTATemplateSelection() {
            document.getElementById('ctaTemplateNickname').value = '';
            document.getElementById('ctaCustomDropdownMenu').style.display = 'none';
        }
        async function selectCTATemplate(id, nickname) {
            document.getElementById('ctaTemplateNickname').value = nickname || '';
            try {
                const response = await fetch('/Admin/GetCTATemplate?id=' + id);
                const result = await response.json();
                if (result.success && result.data) {
                    const d = result.data;
                    const set = (id, v) => { const el = document.getElementById(id); if (el) el.value = v || ''; };
                    set('ctaTitle', d.title); set('ctaSubtitle', d.subtitle); set('ctaButtonText', d.buttonText); set('ctaButtonLink', d.buttonLink);
                }
            } catch (e) { console.error('Load CTA template error', e); }
        }
        async function deleteCTATemplate() {
            const nickname = document.getElementById('ctaTemplateNickname').value.trim();
            if (!nickname) { alert('Select or enter a template nickname to delete.'); return; }
            const t = ctaTemplatesList.find(x => (x.nickname || '').toLowerCase() === nickname.toLowerCase());
            if (!t) { alert('Template not found.'); return; }
            if (!confirm('Delete template "' + nickname + '"?')) return;
            const token = document.querySelector('#ctaForm input[name="__RequestVerificationToken"]').value;
            const fd = new FormData(); fd.append('__RequestVerificationToken', token); fd.append('id', t.id);
            const response = await fetch('/Admin/DeleteCTATemplate', { method: 'POST', body: fd });
            const result = await response.json();
            alert(result.message || (result.success ? 'Deleted.' : 'Error'));
            if (result.success) { clearCTATemplateSelection(); loadCTATemplates(); }
        }
        document.addEventListener('DOMContentLoaded', function() {
            const ctaForm = document.getElementById('ctaForm');
            if (ctaForm) ctaForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const nickname = document.getElementById('ctaTemplateNickname').value.trim();
                if (nickname) {
                    const t = ctaTemplatesList.find(x => (x.nickname || '').toLowerCase() === nickname.toLowerCase());
                    const saveFormData = new FormData();
                    saveFormData.append('__RequestVerificationToken', formData.get('__RequestVerificationToken'));
                    saveFormData.append('Nickname', nickname);
                    saveFormData.append('Title', formData.get('Title')); saveFormData.append('Subtitle', formData.get('Subtitle')); saveFormData.append('ButtonText', formData.get('ButtonText')); saveFormData.append('ButtonLink', formData.get('ButtonLink'));
                    if (t) { saveFormData.append('Id', t.id); await fetch('/Admin/UpdateCTATemplate', { method: 'POST', body: saveFormData }); } else { await fetch('/Admin/SaveCTATemplate', { method: 'POST', body: saveFormData }); }
                }
                const sectionResp = await fetch('/Admin/SaveCTASection', { method: 'POST', body: formData });
                const sectionRes = await sectionResp.json();
                alert(sectionRes.message || (sectionRes.success ? 'Saved.' : 'Error'));
                if (sectionRes.success) toggleCTAEdit();
            });
        });

        const navSettingsForm = document.getElementById('navSettingsForm');
        if (navSettingsForm) navSettingsForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            formData.set('showGraphicDesignLink', document.getElementById('showGraphicDesignLink').checked ? 'true' : 'false');
            formData.set('showDesignLink', document.getElementById('showDesignLink').checked ? 'true' : 'false');
            const resp = await fetch('/Admin/SaveNavSettings', { method: 'POST', body: formData });
            const res = await resp.json();
            alert(res.message || (res.success ? 'Saved.' : 'Error'));
        });

        // ----- Skills categories -----
        const btnLoadDefaultSkills = document.getElementById('btnLoadDefaultSkills');
        if (btnLoadDefaultSkills) btnLoadDefaultSkills.addEventListener('click', async function() {
            if (!confirm('Load default skill categories (Frontend, Backend, Databases, Tools, Practices)? Existing categories with the same title are skipped.')) return;
            const token = document.querySelector('input[name="__RequestVerificationToken"]')?.value;
            const fd = new FormData();
            fd.append('__RequestVerificationToken', token || '');
            const resp = await fetch('/Admin/LoadDefaultSkills', { method: 'POST', body: fd });
            const res = await resp.json();
            alert(res.message || (res.success ? 'Done.' : 'Error'));
            if (res.success) window.location.reload();
        });
        const skillsCategoryFormCard = document.getElementById('skillsCategoryFormCard');
        const skillsFormHeading = document.getElementById('skillsFormHeading');
        function showSkillsForm(heading) {
            if (skillsFormHeading) skillsFormHeading.textContent = heading;
            if (skillsCategoryFormCard) skillsCategoryFormCard.style.display = 'block';
            skillsCategoryFormCard?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        function clearSkillsForm() {
            document.getElementById('skillsCategoryId').value = '0';
            document.getElementById('skillsCategoryTitle').value = '';
            document.getElementById('skillsCategoryDescription').value = '';
            document.getElementById('skillsCategorySkillsText').value = '';
            document.getElementById('skillsCategoryDisplayOrder').value = '1';
            document.getElementById('skillsCategoryIsActive').checked = true;
        }
        const btnAddSkillsCategory = document.getElementById('btnAddSkillsCategory');
        if (btnAddSkillsCategory) btnAddSkillsCategory.addEventListener('click', function() {
            clearSkillsForm();
            showSkillsForm('Add new category');
        });
        document.querySelectorAll('.editSkillsCatBtn').forEach(btn => {
            btn.addEventListener('click', function() {
                const li = this.closest('.skills-category-row');
                document.getElementById('skillsCategoryId').value = li.dataset.id;
                document.getElementById('skillsCategoryTitle').value = li.dataset.title || '';
                document.getElementById('skillsCategoryDescription').value = li.dataset.description || '';
                let skillsText = '';
                try {
                    const raw = li.getAttribute('data-skills-json') || li.dataset.skillsJson;
                    if (raw) {
                        const arr = JSON.parse(raw);
                        skillsText = Array.isArray(arr) ? arr.join('\n') : String(raw).replace(/\|/g, '\n');
                    }
                } catch (_) { }
                if (!skillsText && li.dataset.skills != null) skillsText = (li.dataset.skills || '').replace(/\|/g, '\n');
                document.getElementById('skillsCategorySkillsText').value = skillsText;
                document.getElementById('skillsCategoryDisplayOrder').value = li.dataset.displayorder || '0';
                document.getElementById('skillsCategoryIsActive').checked = li.dataset.active === 'True';
                showSkillsForm('Editing: ' + (li.dataset.title || ''));
            });
        });
        document.querySelectorAll('.deleteSkillsCatBtn').forEach(btn => {
            btn.addEventListener('click', async function() {
                const card = this.closest('.skills-category-row');
                const id = card.dataset.id;
                if (!confirm('Delete this category?')) return;
                const token = document.querySelector('#skillsCategoryForm input[name="__RequestVerificationToken"]')?.value;
                const fd = new FormData();
                fd.append('__RequestVerificationToken', token || '');
                fd.append('id', id);
                const resp = await fetch('/Admin/DeleteSkillsCategory', { method: 'POST', body: fd });
                const res = await resp.json();
                alert(res.message || (res.success ? 'Deleted.' : 'Error'));
                if (res.success) card.closest('.col-12')?.remove();
            });
        });
        const skillsCategoryCancelBtn = document.getElementById('skillsCategoryCancelBtn');
        if (skillsCategoryCancelBtn) skillsCategoryCancelBtn.addEventListener('click', function() {
            clearSkillsForm();
            if (skillsCategoryFormCard) skillsCategoryFormCard.style.display = 'none';
        });
        const skillsCategoryForm = document.getElementById('skillsCategoryForm');
        if (skillsCategoryForm) skillsCategoryForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            formData.set('isActive', document.getElementById('skillsCategoryIsActive').checked ? 'true' : 'false');
            const resp = await fetch('/Admin/SaveSkillsCategory', { method: 'POST', body: formData });
            const res = await resp.json();
            alert(res.message || (res.success ? 'Saved.' : 'Error'));
            if (res.success) {
                sessionStorage.setItem('adminReturnSection', 'skills');
                window.location.reload();
            }
        });

        // Toggle background type
        function toggleBackgroundType() {
            const imageUrlField = document.getElementById('imageUrlField');
            const videoUrlField = document.getElementById('videoUrlField');
            const imageLabel = document.getElementById('imageLabel');
            const videoLabel = document.getElementById('videoLabel');
            const toggle = document.getElementById('backgroundTypeToggle');
            
            // Create particle animation
            createToggleParticles();
            
            if (toggle.checked) {
                // Video selected
                imageUrlField.style.display = 'none';
                videoUrlField.style.display = 'block';
                imageLabel.style.color = '#6b7280';
                imageLabel.style.fontWeight = '400';
                videoLabel.style.color = '#818cf8';
                videoLabel.style.fontWeight = '500';
            } else {
                // Image selected
                imageUrlField.style.display = 'block';
                videoUrlField.style.display = 'none';
                imageLabel.style.color = '#818cf8';
                imageLabel.style.fontWeight = '500';
                videoLabel.style.color = '#6b7280';
                videoLabel.style.fontWeight = '400';
            }
        }

        // Create particle animation
        function createToggleParticles() {
            const particleContainer = document.getElementById('toggleParticles');
            const toggle = document.getElementById('backgroundTypeToggle');
            const numParticles = 8;
            
            // Clear existing particles
            particleContainer.innerHTML = '';
            
            // Calculate the position of the rounded square
            const toggleRect = toggle.getBoundingClientRect();
            const containerRect = particleContainer.getBoundingClientRect();
            
            // The rounded square is positioned based on the toggle state
            const squareOffset = toggle.checked ? toggleRect.width - 12 : 6; // Approximate position of the square
            const squareX = squareOffset - (containerRect.width / 2);
            const squareY = (toggleRect.height / 2) - (containerRect.height / 2);
            
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Position particle at the rounded square location
                particle.style.left = '50%';
                particle.style.top = '50%';
                particle.style.transform = 'translate(-50%, -50%)';
                
                // Random direction and distance from the square
                const angle = (i / numParticles) * 2 * Math.PI;
                const distance = 15 + Math.random() * 10;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                particle.style.setProperty('--x', x + 'px');
                particle.style.setProperty('--y', y + 'px');
                
                // Random delay for staggered effect
                particle.style.animationDelay = (Math.random() * 0.2) + 's';
                
                particleContainer.appendChild(particle);
            }
            
            // Clean up particles after animation
            setTimeout(() => {
                particleContainer.innerHTML = '';
            }, 1000);
        }

        // Toggle image overlay settings
        function toggleImageOverlay() {
            const overlayControls = document.getElementById('imageOverlayControls');
            const toggleCircle = document.getElementById('imageToggleCircle');
            const isExpanded = overlayControls.classList.contains('expanded');
            
            if (isExpanded) {
                overlayControls.classList.remove('expanded');
                toggleCircle.classList.remove('active');
            } else {
                overlayControls.classList.add('expanded');
                toggleCircle.classList.add('active');
            }
        }

        // Toggle video overlay settings
        function toggleVideoOverlay() {
            const overlayControls = document.getElementById('videoOverlayControls');
            const toggleCircle = document.getElementById('videoToggleCircle');
            const isExpanded = overlayControls.classList.contains('expanded');
            
            if (isExpanded) {
                overlayControls.classList.remove('expanded');
                toggleCircle.classList.remove('active');
            } else {
                overlayControls.classList.add('expanded');
                toggleCircle.classList.add('active');
            }
        }

        // Update color preview with opacity
        function updateColorPreview(colorPicker, previewElement, sliderElement) {
            const color = colorPicker.value;
            const opacity = sliderElement.value / 100;
            
            // Convert hex to rgba
            const r = parseInt(color.substr(1, 2), 16);
            const g = parseInt(color.substr(3, 2), 16);
            const b = parseInt(color.substr(5, 2), 16);
            
            previewElement.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
        }

        // Update slider fill and value
        function updateSliderFill(slider, valueElement) {
            const percentage = slider.value;
            valueElement.textContent = percentage + '%';
            
            // Update the glowing bar width
            slider.style.setProperty('--glow-width', percentage + '%');
        }

        // Initialize elegant controls
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize color pickers
            initializeColorPickers();
            
            // Initialize custom sliders
            initializeCustomSliders();
            
            // Initialize form submission
            initializeFormSubmission();
        });

        // Initialize color pickers
        function initializeColorPickers() {
            const imageColorPicker = document.getElementById('imageOverlayColor');
            const videoColorPicker = document.getElementById('videoOverlayColor');
            const imageColorPreview = document.getElementById('imageColorPreview');
            const videoColorPreview = document.getElementById('videoColorPreview');
            const imageSlider = document.getElementById('imageOverlayOpacity');
            const videoSlider = document.getElementById('videoOverlayOpacity');

            // Set initial colors with opacity
            updateColorPreview(imageColorPicker, imageColorPreview, imageSlider);
            updateColorPreview(videoColorPicker, videoColorPreview, videoSlider);

            // Add event listeners for color changes
            imageColorPicker.addEventListener('input', function() {
                updateColorPreview(this, imageColorPreview, imageSlider);
            });

            videoColorPicker.addEventListener('input', function() {
                updateColorPreview(this, videoColorPreview, videoSlider);
            });
        }

        // Initialize custom sliders
        function initializeCustomSliders() {
            initializeCustomSlider('imageSliderThumb', 'imageSliderFill', 'imageOverlayOpacity', 'imageSliderValue', 50);
            initializeCustomSlider('videoSliderThumb', 'videoSliderFill', 'videoOverlayOpacity', 'videoSliderValue', 50);
        }

        // Initialize a single custom slider
        function initializeCustomSlider(thumbId, fillId, hiddenInputId, valueId, initialValue) {
            const thumb = document.getElementById(thumbId);
            const fill = document.getElementById(fillId);
            const hiddenInput = document.getElementById(hiddenInputId);
            const valueDisplay = document.getElementById(valueId);
            const track = thumb.parentElement;

            let isDragging = false;
            let currentValue = initialValue;

            // Set initial position
            updateSliderPosition(currentValue);

            // Mouse events
            thumb.addEventListener('mousedown', startDragging);
            track.addEventListener('mousedown', handleTrackClick);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', stopDragging);

            // Touch events for mobile
            thumb.addEventListener('touchstart', startDragging);
            track.addEventListener('touchstart', handleTrackClick);
            document.addEventListener('touchmove', handleTouchMove);
            document.addEventListener('touchend', stopDragging);

            function startDragging(e) {
                e.preventDefault();
                isDragging = true;
                thumb.style.cursor = 'grabbing';
            }

            function stopDragging() {
                isDragging = false;
                thumb.style.cursor = 'grab';
            }

            function handleMouseMove(e) {
                if (!isDragging) return;
                updateSliderFromEvent(e);
            }

            function handleTouchMove(e) {
                if (!isDragging) return;
                e.preventDefault();
                const touch = e.touches[0];
                updateSliderFromEvent(touch);
            }

            function handleTrackClick(e) {
                updateSliderFromEvent(e);
            }

            function updateSliderFromEvent(e) {
                const rect = track.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
                updateSliderPosition(percentage);
            }

            function updateSliderPosition(percentage) {
                currentValue = Math.round(percentage);
                
                // Update thumb position
                thumb.style.left = percentage + '%';
                
                // Update fill width
                fill.style.width = percentage + '%';
                
                // Update hidden input value
                hiddenInput.value = currentValue;
                
                // Update display value
                valueDisplay.textContent = currentValue + '%';
                
                // Update color preview if applicable
                updateColorPreviewFromSlider(hiddenInputId);
            }

            function updateColorPreviewFromSlider(sliderId) {
                if (sliderId === 'imageOverlayOpacity') {
                    const colorPicker = document.getElementById('imageOverlayColor');
                    const preview = document.getElementById('imageColorPreview');
                    if (colorPicker && preview) {
                        updateColorPreview(colorPicker, preview, { value: currentValue });
                    }
                } else if (sliderId === 'videoOverlayOpacity') {
                    const colorPicker = document.getElementById('videoOverlayColor');
                    const preview = document.getElementById('videoColorPreview');
                    if (colorPicker && preview) {
                        updateColorPreview(colorPicker, preview, { value: currentValue });
                    }
                }
            }
        }

        // Initialize form submission
        function initializeFormSubmission() {
            const heroForm = document.getElementById('heroForm');
            
            heroForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Show loading state
                const submitButton = heroForm.querySelector('button[type="submit"]');
                const originalText = submitButton.innerHTML;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                submitButton.disabled = true;
                
                try {
                    const nickname = document.getElementById('templateNickname').value.trim();
                    let templateResult = null;
                    
                    // Step 1: Handle template saving/updating
                    if (nickname) {
                        templateResult = await handleTemplateSave(nickname);
                        if (!templateResult.success) {
                            showNotification('Error!', templateResult.message, 'error');
                            return;
                        }
                    }
                    
                    // Step 2: Save to frontend
                    const formData = new FormData(heroForm);
                    const fileInput = heroForm.querySelector('input[name="HeroBackgroundImage"]');
                    const heroFile = fileInput?.files?.[0];
                    console.log('[Hero] Submitting hero form. Image file:', heroFile ? { name: heroFile.name, size: heroFile.size, type: heroFile.type } : 'none');
                    for (const [key, value] of formData.entries()) {
                        if (value instanceof File) console.log('[Hero] FormData:', key, '(File)', value.name, value.size, value.type);
                        else console.log('[Hero] FormData:', key, value);
                    }
                    
                    const response = await fetch('/Admin/SaveHeroSection', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                        }
                    });
                    
                    const result = await response.json();
                    console.log('[Hero] Response status:', response.status, 'result:', result.success ? 'success' : 'failed', result.message || '', result.data ? { backgroundImageUrl: result.data.backgroundImageUrl } : '');
                    
                    if (result.success) {
                        // Show success message
                        const message = nickname && templateResult ? 
                            `Template "${nickname}" ${templateResult.updated ? 'updated' : 'saved'} and hero section updated successfully!` :
                            'Hero section updated successfully!';
                        showNotification('Success!', message, 'success');
                        
                        // Hide the form
                        toggleHeroEdit();
                        
                        // Reload templates to reflect changes
                        await loadTemplates();
                        
                        // Frontend will automatically detect changes within 3 seconds
                        console.log('Changes saved successfully - frontend will update automatically');
                    } else {
                        console.warn('[Hero] Save failed:', result.message);
                        showNotification('Error!', result.message, 'error');
                    }
                } catch (error) {
                    console.error('[Hero] Error saving:', error);
                    showNotification('Error!', 'An unexpected error occurred. Please try again.', 'error');
                } finally {
                    // Restore button state
                    submitButton.innerHTML = originalText;
                    submitButton.disabled = false;
                }
            });
        }

        // Handle template saving/updating
        async function handleTemplateSave(nickname) {
            try {
                // Check if template already exists
                const existingTemplate = currentTemplates.find(t => t.nickname.toLowerCase() === nickname.toLowerCase());
                
                if (existingTemplate) {
                    // Update existing template
                    const formData = new FormData();
                    formData.append('Id', existingTemplate.id);
                    formData.append('Nickname', nickname);
                    formData.append('HeaderTitle', document.getElementById('heroTitle').value || '');
                    formData.append('HeaderSubtitle', document.getElementById('heroSubtitle').value || '');
                    formData.append('HeaderDescription', document.getElementById('heroDescription').value || '');
                    formData.append('HeaderBackgroundImageUrl', document.getElementById('heroBackgroundImageUrlHidden').value || '');
                    formData.append('HeaderBackgroundVideoUrl', document.getElementById('heroBackgroundVideo').value || '');
                    formData.append('HeaderPrimaryButtonText', document.getElementById('heroPrimaryButtonText').value || '');
                    formData.append('HeaderPrimaryButtonUrl', document.getElementById('heroPrimaryButtonUrl').value || '');
                    formData.append('ImageOverlayColor', document.getElementById('imageOverlayColor').value || '#000000');
                    formData.append('ImageOverlayOpacity', document.getElementById('imageOverlayOpacity').value || '50');
                    formData.append('VideoOverlayColor', document.getElementById('videoOverlayColor').value || '#000000');
                    formData.append('VideoOverlayOpacity', document.getElementById('videoOverlayOpacity').value || '50');
                    formData.append('__RequestVerificationToken', document.querySelector('input[name="__RequestVerificationToken"]').value);
                    
                    const response = await fetch('/Admin/UpdateHeroTemplate', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        return { success: true, updated: true, message: result.message };
                    } else {
                        return { success: false, message: result.message };
                    }
                } else {
                    // Create new template
                    const formData = new FormData();
                    formData.append('Nickname', nickname);
                    formData.append('HeaderTitle', document.getElementById('heroTitle').value || '');
                    formData.append('HeaderSubtitle', document.getElementById('heroSubtitle').value || '');
                    formData.append('HeaderDescription', document.getElementById('heroDescription').value || '');
                    formData.append('HeaderBackgroundImageUrl', document.getElementById('heroBackgroundImageUrlHidden').value || '');
                    formData.append('HeaderBackgroundVideoUrl', document.getElementById('heroBackgroundVideo').value || '');
                    formData.append('HeaderPrimaryButtonText', document.getElementById('heroPrimaryButtonText').value || '');
                    formData.append('HeaderPrimaryButtonUrl', document.getElementById('heroPrimaryButtonUrl').value || '');
                    formData.append('ImageOverlayColor', document.getElementById('imageOverlayColor').value || '#000000');
                    formData.append('ImageOverlayOpacity', document.getElementById('imageOverlayOpacity').value || '50');
                    formData.append('VideoOverlayColor', document.getElementById('videoOverlayColor').value || '#000000');
                    formData.append('VideoOverlayOpacity', document.getElementById('videoOverlayOpacity').value || '50');
                    formData.append('__RequestVerificationToken', document.querySelector('input[name="__RequestVerificationToken"]').value);
                    
                    const response = await fetch('/Admin/SaveHeroTemplate', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        return { success: true, updated: false, message: result.message };
                    } else {
                        return { success: false, message: result.message };
                    }
                }
            } catch (error) {
                console.error('Error handling template save:', error);
                return { success: false, message: 'An unexpected error occurred while saving template.' };
            }
        }

        // Show notification
        function showNotification(title, message, type) {
            if (type === 'success') {
                showHeroSuccessPopup(title, message);
            } else {
                // Create error notification element
                const notification = document.createElement('div');
                notification.className = `alert alert-danger alert-dismissible fade show position-fixed`;
                notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                notification.innerHTML = `
                    <strong>${title}</strong> ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                // Add to page
                document.body.appendChild(notification);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }
        }

        // Show hero success popup
        function showHeroSuccessPopup(title, message) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'hero-success-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(5, 5, 16, 0.9);
                backdrop-filter: blur(10px);
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease-out;
            `;

            // Create popup card
            const popup = document.createElement('div');
            popup.className = 'hero-success-popup';
            popup.style.cssText = `
                background: linear-gradient(135deg, rgba(0, 0, 10, 0.7), rgba(5, 5, 25, 0.5));
                border: 1px solid rgba(187, 195, 255, 0.1);
                border-radius: 12px;
                padding: 2rem;
                text-align: center;
                max-width: 400px;
                width: 90%;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                animation: slideIn 0.4s ease-out;
            `;

            // Create content
            popup.innerHTML = `
                <div class="success-icon" style="
                    width: 60px;
                    height: 60px;
                    background: linear-gradient(135deg, #818cf8, #6366f1);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 1.5rem;
                    animation: pulse 2s infinite;
                ">
                    <i class="fas fa-check" style="color: white; font-size: 1.5rem;"></i>
                </div>
                <h3 style="color: #818cf8; margin-bottom: 1rem; font-weight: 500;">${title}</h3>
                <p style="color: #a5b4fc; margin-bottom: 2rem; line-height: 1.6;">${message}</p>
                <button class="btn btn-primary" onclick="closeHeroSuccessPopup()" style="
                    background: linear-gradient(135deg, #818cf8, #6366f1);
                    border: none;
                    padding: 0.75rem 2rem;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(129, 140, 248, 0.3);
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(129, 140, 248, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(129, 140, 248, 0.3)'">
                    <i class="fas fa-arrow-right"></i>
                    Continue
                </button>
            `;

            // Add styles for animations
            const style = document.createElement('style');
            style.textContent = `
                @@keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @@keyframes slideIn {
                    from { 
                        opacity: 0; 
                        transform: translateY(-30px) scale(0.9); 
                    }
                    to { 
                        opacity: 1; 
                        transform: translateY(0) scale(1); 
                    }
                }
                @@keyframes pulse {
                    0%, 100% { 
                        transform: scale(1); 
                        box-shadow: 0 0 0 0 rgba(129, 140, 248, 0.7); 
                    }
                    50% { 
                        transform: scale(1.05); 
                        box-shadow: 0 0 0 10px rgba(129, 140, 248, 0); 
                    }
                }
            `;
            document.head.appendChild(style);

            // Add to page
            overlay.appendChild(popup);
            document.body.appendChild(overlay);

            // Add close function to global scope
            window.closeHeroSuccessPopup = function() {
                overlay.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    if (overlay.parentNode) {
                        overlay.remove();
                    }
                    if (style.parentNode) {
                        style.remove();
                    }
                }, 300);
            };

            // Add fadeOut animation
            const fadeOutStyle = document.createElement('style');
            fadeOutStyle.textContent = `
                @@keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(fadeOutStyle);
        }

        // Hero Template Management Functions
        let currentTemplates = [];

        // Load templates on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded - checking form state');
            const form = document.getElementById('heroEditForm');
            console.log('Form display on load:', form.style.display);
            console.log('Form computed display on load:', window.getComputedStyle(form).display);
            
            loadTemplates();
        });

        // Load all templates
        async function loadTemplates() {
            try {
                const response = await fetch('/Admin/GetHeroTemplates');
                const result = await response.json();
                
                if (result.success) {
                    currentTemplates = result.data;
                    updateTemplateDropdown();
                    setupCustomDropdown();
                } else {
                    console.error('Error loading templates:', result.message);
                }
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }
        
        // Close dropdown with smooth animation
        function closeDropdownSmoothly() {
            const dropdownMenu = document.getElementById('customDropdownMenu');
            const card = dropdownMenu.closest('.card');
            const inputField = document.getElementById('templateNickname');
            dropdownMenu.style.opacity = '0';
            dropdownMenu.style.transform = 'translateY(-10px) scale(0.95)';
            card.classList.remove('expanded-for-dropdown');
            
            // Remove unified glow and restore original styles
            const inputGroup = inputField.closest('.input-group');
            inputGroup.style.boxShadow = '';
            inputGroup.style.borderRadius = '';
            // Restore input field styling
            inputField.style.borderColor = '';
            inputField.style.outline = '';
            
            // Restore dropdown button radius and border
            const dropdownBtn = document.getElementById('templateDropdownBtn');
            dropdownBtn.style.borderBottomRightRadius = '';
            dropdownBtn.style.borderRight = '';
            
            setTimeout(() => {
                dropdownMenu.style.display = 'none';
            }, 300);
        }
        
        // Setup custom dropdown
        function setupCustomDropdown() {
            const dropdownBtn = document.getElementById('templateDropdownBtn');
            const dropdownMenu = document.getElementById('customDropdownMenu');
            
            console.log('Setting up custom dropdown');
            console.log('Button:', dropdownBtn);
            console.log('Menu:', dropdownMenu);
            
            let isOpen = false;
            
            dropdownBtn.addEventListener('click', function(e) {
                console.log('Button clicked!');
                e.preventDefault();
                e.stopPropagation();
                
                if (isOpen) {
                    console.log('Closing dropdown');
                    closeDropdownSmoothly();
                    isOpen = false;
                } else {
                    console.log('Opening dropdown');
                    const card = dropdownMenu.closest('.card');
                    const inputField = document.getElementById('templateNickname');
                    const dropdownBtn = document.getElementById('templateDropdownBtn');
                    // Reset to initial state first
                    dropdownMenu.style.opacity = '0';
                    dropdownMenu.style.transform = 'translateY(-10px) scale(0.95)';
                    
                    // Show dropdown and expand card
                    dropdownMenu.style.display = 'block';
                    card.classList.add('expanded-for-dropdown');
                    
                    // Remove individual glows from input and button
                    inputField.style.boxShadow = 'none';
                    dropdownBtn.style.boxShadow = 'none';
                    // Remove input field focus border
                    inputField.style.borderColor = 'rgba(129, 140, 248, 0.3)';
                    inputField.style.outline = 'none';
                    
                    // Apply glow to input group (top, left, right only)
                    const inputGroup = inputField.closest('.input-group');
                    inputGroup.style.setProperty(
                      'box-shadow',
                      '-4px 0 8px -4px rgba(129,140,248,0.25), 4px 0 8px -4px rgba(129,140,248,0.25), 0 -4px 8px -4px rgba(129,140,248,0.25)',
                      'important'
                    );
                    inputGroup.style.borderRadius = '4px 4px 0 0';
                    // Remove bottom right radius from dropdown button and adjust border
                    dropdownBtn.style.borderBottomRightRadius = '0';
                    dropdownBtn.style.borderRight = '1px solid rgba(129, 140, 248, 0.3)';
                    
                    // Apply glow to dropdown (bottom, left, right only)
                    dropdownMenu.style.setProperty(
                      'box-shadow',
                      '0 4px 8px -4px rgba(129,140,248,0.25), -4px 0 8px -4px rgba(129,140,248,0.25), 4px 0 8px -4px rgba(129,140,248,0.25)',
                      'important'
                    );
                    dropdownMenu.style.border = '1px solid rgba(129, 140, 248, 0.3)';
                    dropdownMenu.style.borderTop = 'none';
                    dropdownMenu.style.borderRadius = '0 0 4px 4px';
                    // Fix 1-pixel alignment with button
                    dropdownMenu.style.right = '1px';
                    
                    // Force reflow to ensure display: block is applied
                    dropdownMenu.offsetHeight;
                    
                    // Smooth open animation
                    requestAnimationFrame(() => {
                        dropdownMenu.style.opacity = '1';
                        dropdownMenu.style.transform = 'translateY(0) scale(1)';
                    });
                    isOpen = true;
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target) && isOpen) {
                    closeDropdownSmoothly();
                    isOpen = false;
                }
            });
            
            // Close dropdown when pressing Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && isOpen) {
                    closeDropdownSmoothly();
                    isOpen = false;
                }
            });
        }

        // Update template dropdown
        function updateTemplateDropdown() {
            const templateOptions = document.getElementById('templateOptions');
            templateOptions.innerHTML = '';
            
            currentTemplates.forEach((template, idx) => {
                const option = document.createElement('div');
                option.className = 'dropdown-item';
                option.style.cssText = 'color: #818cf8; background: transparent; padding: 0.5rem 1rem; cursor: pointer; transition: background 0.2s ease; border-top: 1px solid rgba(129, 140, 248, 0.2);';
                option.textContent = `${template.nickname} (${template.title})`;
                option.onclick = function(e) {
                    e.preventDefault();
                    selectTemplate(template.id, template.nickname);
                    // Close dropdown after selection with smooth animation
                    closeDropdownSmoothly();
                };
                
                // Add hover effect
                option.onmouseenter = function() {
                    this.style.background = 'rgba(129, 140, 248, 0.1)';
                };
                option.onmouseleave = function() {
                    this.style.background = 'transparent';
                };
                
                templateOptions.appendChild(option);
            });
        }

        // Select template from dropdown
        async function selectTemplate(templateId, templateNickname) {
            // Update the input field with the selected nickname
            document.getElementById('templateNickname').value = templateNickname;
            
            // Load the template data
            await loadTemplateById(templateId);
        }

        // Clear template selection
        function clearTemplateSelection() {
            document.getElementById('templateNickname').value = '';
            // Close dropdown after clearing with smooth animation
            closeDropdownSmoothly();
        }

        // Load template by ID
        async function loadTemplateById(templateId) {
            try {
                const response = await fetch(`/Admin/GetHeroTemplate?id=${templateId}`);
                const result = await response.json();
                
                if (result.success) {
                    const template = result.data;
                    
                    // Fill nickname field with template name
                    document.getElementById('templateNickname').value = template.nickname || '';
                    
                    // Fill form fields
                    document.getElementById('heroTitle').value = template.title || '';
                    document.getElementById('heroSubtitle').value = template.subtitle || '';
                    document.getElementById('heroDescription').value = template.description || '';
                    document.getElementById('heroBackgroundImageUrlHidden').value = template.backgroundImageUrl || '';
                    var hintEl = document.getElementById('heroImageUploadHint');
                    if (hintEl) hintEl.textContent = (template.backgroundImageUrl ? 'Current image: set. Upload a new file to replace it.' : 'Upload stores the image on this server. Upload a new file to replace the current image.');
                    document.getElementById('heroBackgroundVideo').value = template.backgroundVideoUrl || '';
                    document.getElementById('heroPrimaryButtonText').value = template.primaryButtonText || '';
                    document.getElementById('heroPrimaryButtonUrl').value = template.primaryButtonUrl || '';
                    document.getElementById('imageOverlayColor').value = template.overlayColor || '#000000';
                    document.getElementById('imageOverlayOpacity').value = Math.round(template.overlayOpacity * 100) || 50;
                    document.getElementById('videoOverlayColor').value = template.overlayColor || '#000000';
                    document.getElementById('videoOverlayOpacity').value = Math.round(template.overlayOpacity * 100) || 50;
                    
                    // Update sliders and previews
                    updateSliderFill(document.getElementById('imageOverlayOpacity'), document.getElementById('imageSliderValue'));
                    updateSliderFill(document.getElementById('videoOverlayOpacity'), document.getElementById('videoSliderValue'));
                    
                    // Update color previews
                    const imageColorPicker = document.getElementById('imageOverlayColor');
                    const videoColorPicker = document.getElementById('videoOverlayColor');
                    const imageColorPreview = document.getElementById('imageColorPreview');
                    const videoColorPreview = document.getElementById('videoColorPreview');
                    
                    if (imageColorPicker && imageColorPreview) {
                        updateColorPreview(imageColorPicker, imageColorPreview, document.getElementById('imageOverlayOpacity'));
                    }
                    if (videoColorPicker && videoColorPreview) {
                        updateColorPreview(videoColorPicker, videoColorPreview, document.getElementById('videoOverlayOpacity'));
                    }
                    
                    // Don't automatically show the form - let user click Edit button
                    
                    showNotification('Success!', `Template "${template.nickname}" loaded successfully!`, 'success');
                } else {
                    showNotification('Error!', result.message, 'error');
                }
            } catch (error) {
                console.error('Error loading template:', error);
                showNotification('Error!', 'An unexpected error occurred.', 'error');
            }
        }

        // Delete template from dropdown
        async function deleteTemplate() {
            const nickname = document.getElementById('templateNickname').value.trim();
            
            if (!nickname) {
                showNotification('Error!', 'Please enter or select a template nickname to delete.', 'error');
                return;
            }
            
            // Find template by nickname
            const template = currentTemplates.find(t => t.nickname.toLowerCase() === nickname.toLowerCase());
            
            if (!template) {
                showNotification('Error!', 'Template not found. Please select an existing template.', 'error');
                return;
            }
            
            await deleteTemplateById(template.id);
        }

        // Delete template by ID
        async function deleteTemplateById(templateId) {
            const template = currentTemplates.find(t => t.id == templateId);
            
            if (!template) {
                showNotification('Error!', 'Template not found.', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete the template "${template.nickname}"?`)) {
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('id', templateId);
                formData.append('__RequestVerificationToken', document.querySelector('input[name="__RequestVerificationToken"]').value);
                
                const response = await fetch('/Admin/DeleteHeroTemplate', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Success!', result.message, 'success');
                    await loadTemplates();
                } else {
                    showNotification('Error!', result.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting template:', error);
                showNotification('Error!', 'An unexpected error occurred.', 'error');
            }
        }
    </script>
}